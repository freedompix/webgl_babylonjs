<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="utf-8"/>
    <title>URBAN:JUNGLE</title>
    <!--- Link to the last version of BabylonJS --->
	
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>

	</script>
    <style>
        html, body {
            overflow: hidden;
            width   : 100%;
            height  : 100%;
            margin  : 0;
            padding : 0;
        }

        #renderCanvas {
            width   : 100%;
            height  : 100%;
            touch-action: none;
        }
    </style>
</head>
<body>

 <audio id="soundBG" controls autoplay>
  <source src="http://ice4.somafm.com/deepspaceone-128-mp3â€" type="audio/mpeg">
  Your browser does not support the audio element.
</audio> 


    <canvas id="renderCanvas"></canvas>
    <script>
	var timer=0;
	var loadingStatusNeon=0;
	var loadingStatusTemple=0;
	var loadingStatusPalms=0;

	
	
window.addEventListener('DOMContentLoaded', function(){
document.getElementById('soundBG').play();		

            // get the canvas DOM element
            var canvas = document.getElementById('renderCanvas');

            // load the 3D engine
            var engine = new BABYLON.Engine(canvas, true);

            // createScene function that creates and return the scene
            var createScene = function(){
                // create a basic BJS Scene object
                var scene = new BABYLON.Scene(engine);
				
				
				//scene.debugLayer.show();

                // create a FreeCamera, and set its position to (x:0, y:5, z:-10)
                var camera = new BABYLON.FreeCamera('camera1', new BABYLON.Vector3(0, -5,-25), scene);

                // target the camera to scene origin
                camera.setTarget(BABYLON.Vector3.Zero());
				camera.fov=1.5;

                // attach the camera to the canvas
                camera.attachControl(canvas, false);
				
				

//fog	
scene.fogMode = BABYLON.Scene.FOGMODE_EXP;		
scene.fogColor = new BABYLON.Color3(0.9, 0.9, 0.85);
scene.fogDensity = 0.03;
scene.clearColor = new BABYLON.Color3(0.9, 0.9, 0.85);

//abberation
var parameters = {  edge_blur: 5.0,  chromatic_aberration: 2.0,  distortion: 0.3,};
var lensEffect = new BABYLON.LensRenderingPipeline('lensEffects', parameters, scene, 1.0, camera);
scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline('lensEffects', camera);




                // create a basic light, aiming 0,1,0 - meaning, to the sky
var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(-0.1,1,0.3), scene);
var light2 = new BABYLON.SpotLight("spotLight", new BABYLON.Vector3(0, 45, 10), new BABYLON.Vector3(0.3, -0.71, 0), Math.PI / 3, 2, scene);




                // create a built-in "sphere" shape; its constructor takes 6 params: name, segment, diameter, scene, updatable, sideOrientation 
 //               var sphere = BABYLON.Mesh.CreateSphere('sphere1', 16, 2, scene);





    //Creation of a repeated textured material
var myMaterial = new BABYLON.StandardMaterial("myMaterial1", scene);
var myTexture  = new BABYLON.Texture("textures/texture.jpg", scene);
  
 myMaterial.bumpTexture = new BABYLON.Texture("textures/6.jpg", scene);
 myMaterial.diffuseTexture  = new BABYLON.Texture("textures/texture.jpg", scene); 
 myMaterial.emissiveTexture = new BABYLON.Texture("textures/texture.jpg", scene); 
 myMaterial.emissiveColor = new BABYLON.Color3.White();
 
 

 
scene.getMaterialByID("myMaterial1").diffuseTexture.uScale = 4.0;
scene.getMaterialByID("myMaterial1").diffuseTexture.vScale = 4.0;

scene.getMaterialByID("myMaterial1").diffuseTexture.uScale = 4.0;
scene.getMaterialByID("myMaterial1").diffuseTexture.vScale = 4.0;


  





















  
  
  
//  myMaterial.backFaceCulling = false;

var wall_1 = BABYLON.MeshBuilder.CreateBox("wall1", {height: 200, width: 2, depth: 200}, scene);
var wall_2 = BABYLON.MeshBuilder.CreateBox("wall2", {height: 200, width: 2, depth: 200}, scene);
var wall_3 = BABYLON.MeshBuilder.CreateBox("wall3", {height: 200, width: 2, depth: 200}, scene);
var wall_4 = BABYLON.MeshBuilder.CreateBox("wall4", {height: 200, width: 2, depth: 200}, scene);



scene.getMeshByID('wall1').position.x = -12; 
scene.getMeshByID('wall1').position.y = -3; 
scene.getMeshByID('wall1').position.z = 0; 
 
scene.getMeshByID('wall2').position.x = 12; 
scene.getMeshByID('wall2').position.y = -3;
scene.getMeshByID('wall2').position.z = 0;

scene.getMeshByID('wall3').position.x = -12; 
scene.getMeshByID('wall3').position.y = -3;
scene.getMeshByID('wall3').position.z = 200; 

scene.getMeshByID('wall4').position.x = 12; 
scene.getMeshByID('wall4').position.y = -3;
scene.getMeshByID('wall4').position.z = 200       ;





wall_1.material = myMaterial;
wall_2.material = myMaterial;
wall_3.material = myMaterial;
wall_4.material = myMaterial;




 







    var bench =
        BABYLON.SceneLoader.ImportMesh("sign1_matSign1_0", "./scenes/japanese_neon_sign_low_poly_background/", "scene.gltf", scene, function (bench) {
            bench[0].position = new BABYLON.Vector3(-2, -4, 20);
            var bench1Scale = 1.;
          //  bench[0].scaling = new BABYLON.Vector3(0.5, 1, 1);
			
						   for(var i = 0; i < bench.length; i++){
		//    
				window.loadingStatusNeon=1;
            console.log(bench[i].name+'');
					window.loadingStatusNeon=1;
        }
        });


    var bench2 =
        BABYLON.SceneLoader.ImportMesh("", "./scenes/island/", "scene.gltf", scene, function (bench) {
            bench[0].position = new BABYLON.Vector3(4, -6, -20);
            //window.templeScale = 0.010;
			bench1Scale=0.004;
            bench[0].scaling = new BABYLON.Vector3(bench1Scale, bench1Scale, bench1Scale);

			
var axis = new BABYLON.Vector3(1, 1, 1);
var angle = Math.PI / 8;
var quaternion = new BABYLON.Quaternion.RotationAxis(axis, angle);

		

		
var axis = new BABYLON.Vector3(0, 1, 0);
var pi_angle=130;
var angle = -Math.PI * (pi_angle/180);
angle=4.25;
var quaternion = new BABYLON.Quaternion.RotationAxis(axis, angle);
bench[0].rotationQuaternion = quaternion;
//	console.log(bench[0].name);
	
	
    var island2 = bench[0].clone('island2');

island2.flipFaces(true);	
scene.removeMesh(bench[0]);
bench[0].dispose();




			
        });


/////////////////


    var bench3 =
        BABYLON.SceneLoader.ImportMesh("", "./scenes/palms/", "scene.gltf", scene, function (importedMeshes) {
            importedMeshes[0].position = new BABYLON.Vector3(-3, -44, 50);
			importedMeshes[0].rotation = new BABYLON.Vector3(0, 0, 0);
			importedMeshes[0].scaling  = new BABYLON.Vector3(7, 7, 7);
		for(var i = 0; i < importedMeshes.length; i++){console.log(importedMeshes[i].name+''); }
	
	window.loadingStatusPalms=1;
	console.log('Palms done');
	

	
	
        });

////






// 




                // return the created scene
				
                return scene;
				
				
				
				
            }





            // call the createScene function
            var scene = createScene(); 

////////////





            // run the render loop
            engine.runRenderLoop(function(){
                scene.render();
				window.timer++;
				
				
		//		scene.getMeshByID('sphere1').position.x = scene.getMeshByID('sphere1').position.x-0.01;  
				
scene.getMeshByID('wall1').position.z = scene.getMeshByID('wall1').position.z-0.15;  
scene.getMeshByID('wall2').position.z = scene.getMeshByID('wall2').position.z-0.15; 
scene.getMeshByID('wall3').position.z = scene.getMeshByID('wall3').position.z-0.15;  
scene.getMeshByID('wall4').position.z = scene.getMeshByID('wall4').position.z-0.15; 

 if (scene.getMeshByID('wall1').position.z <= -200) scene.getMeshByID('wall1').position.z =scene.getMeshByID('wall1').position.z +400;
 if (scene.getMeshByID('wall2').position.z <= -200) scene.getMeshByID('wall2').position.z =scene.getMeshByID('wall2').position.z +400;
 if (scene.getMeshByID('wall3').position.z <= -200) scene.getMeshByID('wall3').position.z =scene.getMeshByID('wall3').position.z +400;
 if (scene.getMeshByID('wall4').position.z <= -200) scene.getMeshByID('wall4').position.z =scene.getMeshByID('wall4').position.z +400;


if (window.loadingStatusTemple==1)
{
//scene.getNodeByName('island2').position.z =scene.getNodeByName('island2').position.z-0.15;
scene.getNodeByName('island2').rotation.z =scene.getNodeByName('island2').rotation.y-1.15;

var axis = new BABYLON.Vector3(0, 1, 0);
var quaternion = new BABYLON.Quaternion.RotationAxis(axis, (3.25+ window.timer * 0.01));
scene.getNodeByName('island2').rotationQuaternion = quaternion;
console.log('loaded temple true');

}



if (window.loadingStatusPalms==1)
{
scene.getMeshByID('palm01').position.y = scene.getMeshByID('palm01').position.y+(0.15/7); 
scene.getMeshByID('palm02').position.y = scene.getMeshByID('palm02').position.y+(0.15/7); 
 if (scene.getMeshByID('palm01').position.y >= 10) scene.getMeshByID('palm01').position.y =scene.getMeshByID('palm01').position.y -20;
 if (scene.getMeshByID('palm02').position.y >= 10) scene.getMeshByID('palm02').position.y =scene.getMeshByID('palm02').position.y -20;



//console.log('loaded palms');

}


if (window.loadingStatusNeon==1)
{
scene.getMeshByID('sign1_matSign1_0').position.z = scene.getMeshByID('sign1_matSign1_0').position.z-0.15; 
}


 });





            // the canvas/window resize event handler
            window.addEventListener('resize', function(){
                engine.resize();
				
				
            });
        });
    </script>
</body>
</html>
